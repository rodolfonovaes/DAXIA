SELECT	DISTINCT	
QI2.QI2_FILIAL AS FILIAL ,
QI2.QI2_FNC AS CODIGO_FNC,
QI2.QI2_REV AS REVISAO_FNC , 
CASE 
	WHEN QI2_TPFIC = '1' THEN 'NAO CONFORMIDADE POTENCIAL ' 
	WHEN QI2_TPFIC = '2' THEN 'NAO CONFORMIDADE EXISTENTE' 
	WHEN QI2_TPFIC = '3' THEN 'MELHORIA' 
	END AS CLASSIFC_NC,
CASE 
	WHEN QI2_PRIORI = '1' THEN 'BAIXA' 
	WHEN QI2_PRIORI = '2' THEN 'MEDIA' 
	WHEN QI2_PRIORI = '3' THEN 'ALTA' 
	END AS PRIORIDADE,
CASE 
	WHEN QI2_STATUS = '1' THEN 'REGISTRADA' 
	WHEN QI2_STATUS = '2' THEN 'EM ANALISE' 
	WHEN QI2_STATUS = '3' THEN 'PROCEDE' 
	WHEN QI2_STATUS = '4' THEN 'NAO PROCEDE' 
	WHEN QI2_STATUS = '5' THEN 'CANCELADA' 
	END AS SITUACAO,
QI2.QI2_CODORI AS COD_ORIGEM,
QI2.QI2_ORIGEM AS ORIGEM_MODULO, 
QI2.QI2_CODCAU AS COD_CAUSA ,
--QI0.QI0_DESC AS DESC_CAUSA,
QI2.QI2_REGIST AS DT_REGISTRO, 
QI2.QI2_OCORRE AS DT_OCORRE ,
QI2.QI2_CONPRE AS DT_CONCL_PREVISTA ,
QI2.QI2_CONREA AS DT_CONCL_REAL ,
QI2.QI2_ORIDEP AS DEP_ORIGEM ,
--QAD.QAD_DESC AS NOME_DEP_ORIGEM
QI2.QI2_DESDEP AS DEP_DESTINO ,
--QADD.QAD_DESC AS NOME_DEP_DESTINO
QI2.QI2_MATRES AS COD_USR_RESP ,
--QAA.QAA_NOME AS NOME_USR_RESP,
QI2.QI2_CODPRO AS PRODUTO, 
--desc prod SB1
QI2.QI2_MATDEP AS DEPTO_USR_DIGIT,
--desc depto QAD
QI2.QI2_MAT AS COD_USR_DIGIT  ,
--nome QAA
QI2.QI2_CODCLI AS COD_CLIENTE, 
QI2.QI2_LOJCLI AS LOJA_CLIENTE ,
QI2.QI2_CODFOR AS COD_FORNECEDOR, 
QI2.QI2_LOJFOR AS LOJA_FORNECEDOR, 
QI2.QI2_LOTE AS LOTE ,
QI2.QI2_OP AS ORDEM_PROD ,
QI2.QI2_QTDPRO AS QTD_PROD ,
QI2.QI2_QTDDEV AS QTD_DEVOLVIDA 
FROM	QI2010 QI2 (NOLOCK)
LEFT OUTER JOIN QI3010 QI3 (NOLOCK) ON QI3.QI3_FILIAL = QI2.QI2_FILIAL AND  QI3.QI3_CODIGO = QI2.QI2_CODACA AND QI3.QI3_REV = QI2.QI2_REVACA AND QI3.D_E_L_E_T_ = '' 
LEFT OUTER JOIN QI5010 QI5 ON QI5.QI5_FILIAL = QI3.QI3_FILIAL AND  QI5.QI5_CODIGO = QI3.QI3_CODIGO AND  QI5.QI5_REV = QI3.QI3_REV AND QI3.D_E_L_E_T_ = '' 
--
--LEFT OUTER JOIN QAD010 QAD ON QAD.QAD_FILIAL = QI2.QI2_FILORI AND  QAD.QAD_CUSTO = QI2.QI2_ORIDEP AND QAD.D_E_L_E_T_ = '' 
--LEFT OUTER JOIN QAD010 QADD ON QADD.QAD_FILIAL = QI2.QI2_FILORI AND  QADD.QAD_CUSTO = QI2.QI2_DESDEP AND QADD.D_E_L_E_T_ = '' 
--LEFT OUTER JOIN QAA010 QAA ON QAA.QAA_FILIAL = QI2.QI2_FILRES AND  QAA.QAA_MAT = QI2.QI2_MATRES AND QAA.D_E_L_E_T_ = '' 
WHERE	QI2.D_E_L_E_T_ = '' 
--AND QI2_FNC = '000000000012020'  -- Caso queira selecionar somente um produto
--AND QI3_CODIGO IS NULL -- Fichas sem Plano de Acao
--AND ( QI2.QI2_CONPRE < '20200901' AND QI2.QI2_CONREA = ' ' )  -- FICHAS VENCIDAS 
--AND QI5_REALIZ = '' AND QI5_STATUS = '0' AND QI5_PRAZO < '20200901'   -- PLANOS COM ETAPAS VENCIDAS
ORDER BY QI2.QI2_FNC, QI2_REV ASC





--
-- DESCRICAO DA CAUSA
SELECT QI0_DESC AS DESC_CAUSA
FROM  QI0010 QI0 
WHERE QI0.QI0_TIPO = '1' AND  
QI0.QI0_CODIGO = --QI2.QI2_CODCAU--
AND QI0.D_E_L_E_T_ = '' 



--NOME DEPARTAMENTO, USA A MESMA QUERY PARA DEPTO ORIGEM , DESTINO , e DEPTO_USR_DIGIT
SELECT QAD.QAD_DESC AS NOME_DEP_ORIGEM
FROM QAD010 QAD 
WHERE QAD.QAD_FILIAL = --QI2.QI2_FILORI-- 
AND  QAD.QAD_CUSTO = --QI2.QI2_ORIDEP 
AND QAD.D_E_L_E_T_ = '' 

--QAA_NOME AS NOME_USR_RESP, usado tambem para COD_USR_DIGIT
SELECT QAA_NOME 
FROM QAA010 QAA 
WHERE QAA.QAA_FILIAL = --QI2.QI2_FILRES 
AND  QAA.QAA_MAT = --QI2.QI2_MATRES 
AND QAA.D_E_L_E_T_ = '' 



